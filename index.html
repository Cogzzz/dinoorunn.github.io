<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blood Delivery Run</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #game-canvas {
            background-color: #fff;
            border: 1px solid #ccc;
        }

        #instructions {
            margin-top: 20px;
            text-align: center;
            color: #666;
        }
    </style>
</head>

<body>
    <div id="game-container">
        <canvas id="game-canvas" width="750" height="250"></canvas>
        <div id="instructions">
            <p>Tekan SPASI untuk melompat. Jika game over, tekan SPASI untuk mulai kembali.</p>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const boardWidth = 750;
        const boardHeight = 250;

        const dinosaurWidth = 88;
        const dinosaurHeight = 94;
        const dinosaurX = 50;
        let dinosaurY = boardHeight - dinosaurHeight;

        const cactus1Width = 34;
        const cactus2Width = 69;
        const cactus3Width = 102;
        const cactusHeight = 70;
        const cactusX = 700;
        const cactusY = boardHeight - cactusHeight;

        let velocityX = -8;
        let velocityY = 10;
        const gravity = 0.6;

        let gameOver = false;
        let score = 0;
        let cactusArray = [];

        let runFrame = 0;
        const runFrameCount = 2;
        let animationCounter = 0;
        const animationSpeed = 7;

        // Blood
        const bloodWidth = 50;
        const bloodHeight = 60;
        const bloodY = boardHeight - bloodHeight - 10;
        let bloodArray = [];
        let collectedBlood = 0;
        const bloodGoal = 5;

        // Hospital
        const hospitalWidth = 100;
        const hospitalHeight = 80;
        const hospitalY = boardHeight - hospitalHeight;
        let hospital = null;

        // Images
        const dinosaurRun1 = new Image();
        const dinosaurRun2 = new Image();
        const dinosaurDeadImg = new Image();
        const dinosaurJumpImg = new Image();
        const cactus1Img = new Image();
        const cactus2Img = new Image();
        const cactus3Img = new Image();
        const bloodImg = new Image();
        const hospitalImg = new Image();

        dinosaurRun1.src = 'img/Ghibli Run-High.png';
        dinosaurRun2.src = 'img/Ghibli Run-Pass.png';
        dinosaurDeadImg.src = 'img/ghibli dead.png';
        dinosaurJumpImg.src = 'img/Ghibli Jump.png';
        cactus1Img.src = 'img/cactus1.png';
        cactus2Img.src = 'img/cactus2.png';
        cactus3Img.src = 'img/cactus3.png';
        bloodImg.src = 'img/blood.png'; // Ganti sesuai asset kamu
        hospitalImg.src = 'img/hospital.png'; // Ganti sesuai asset kamu

        const dinosaur = {
            x: dinosaurX,
            y: dinosaurY,
            width: dinosaurWidth,
            height: dinosaurHeight,
            img: dinosaurRun1,
            isRunning: true
        };

        function placeCactus() {
            if (gameOver) return;

            const chance = Math.random();
            let cactus = null;
            if (chance > 0.9) {
                cactus = { x: cactusX, y: cactusY, width: cactus3Width, height: cactusHeight, img: cactus3Img };
            } else if (chance > 0.7) {
                cactus = { x: cactusX, y: cactusY, width: cactus2Width, height: cactusHeight, img: cactus2Img };
            } else if (chance > 0.5) {
                cactus = { x: cactusX, y: cactusY, width: cactus1Width, height: cactusHeight, img: cactus1Img };
            }

            if (cactus) cactusArray.push(cactus);
            if (cactusArray.length > 10) cactusArray.shift();
        }
        
        function placeBlood() {
            if (gameOver || collectedBlood >= bloodGoal) return;

            if (Math.random() > 0.4) {
                const bloodX = boardWidth;
                const tooClose = cactusArray.some(cactus =>
                    Math.abs(cactus.x - bloodX) < 60
                );

                if (!tooClose) {
                    bloodArray.push({
                        x: bloodX,
                        y: bloodY,
                        width: bloodWidth,
                        height: bloodHeight,
                        img: bloodImg
                    });
                }
            }

            if (bloodArray.length > 10) bloodArray.shift();
        }

        function spawnHospital() {
            if (!hospital && collectedBlood >= bloodGoal) {
                hospital = {
                    x: boardWidth + 100,
                    y: hospitalY,
                    width: hospitalWidth,
                    height: hospitalHeight,
                    img: hospitalImg
                };
            }
        }

        function collision(a, b) {
            return a.x < b.x + b.width &&
                a.x + a.width > b.x &&
                a.y < b.y + b.height &&
                a.y + a.height > b.y;
        }

        function update() {
            if (gameOver) return;

            velocityY += gravity;
            dinosaur.y += velocityY;
            if (dinosaur.y > dinosaurY) {
                dinosaur.y = dinosaurY;
                velocityY = 0;
                dinosaur.isRunning = true;
            }

            if (dinosaur.isRunning) {
                animationCounter++;
                if (animationCounter >= animationSpeed) {
                    runFrame = (runFrame + 1) % runFrameCount;
                    dinosaur.img = runFrame === 0 ? dinosaurRun1 : dinosaurRun2;
                    animationCounter = 0;
                }
            }

            for (let i = 0; i < cactusArray.length; i++) {
                const cactus = cactusArray[i];
                cactus.x += velocityX;
                if (collision(dinosaur, cactus)) {
                    gameOver = true;
                    dinosaur.img = dinosaurDeadImg;
                }
            }

            for (let i = 0; i < bloodArray.length; i++) {
                const blood = bloodArray[i];
                blood.x += velocityX;
                if (collision(dinosaur, blood)) {
                    bloodArray.splice(i, 1);
                    collectedBlood++;
                    i--;
                }
            }

            spawnHospital();
            if (hospital) {
                hospital.x += velocityX;
                if (collision(dinosaur, hospital)) {
                    gameOver = true;
                    alert("Berhasil! Kamu telah mengantarkan darah ke rumah sakit!");
                }
            }

            score++;
        }

        function draw() {
            ctx.clearRect(0, 0, boardWidth, boardHeight);
            ctx.drawImage(dinosaur.img, dinosaur.x, dinosaur.y, dinosaur.width, dinosaur.height);

            for (let cactus of cactusArray) {
                ctx.drawImage(cactus.img, cactus.x, cactus.y, cactus.width, cactus.height);
            }

            for (let blood of bloodArray) {
                ctx.drawImage(blood.img, blood.x, blood.y, blood.width, blood.height);
            }

            if (hospital) {
                ctx.drawImage(hospital.img, hospital.x, hospital.y, hospital.width, hospital.height);
            }

            ctx.fillStyle = "black";
            ctx.font = "32px Courier";
            ctx.fillText(gameOver ? "Game Over: " + score : score, 10, 35);
            ctx.fillText("Darah: " + collectedBlood + "/" + bloodGoal, 10, 70);
        }

        function gameLoop() {
            update();
            draw();
            if (!gameOver) requestAnimationFrame(gameLoop);
        }

        let placeCactusInterval = setInterval(placeCactus, 500);
        let placeBloodInterval = setInterval(placeBlood, 1000);

        document.addEventListener("keydown", function (event) {
            if (event.code === "Space") {
                if (dinosaur.y === dinosaurY) {
                    velocityY = -14;
                    dinosaur.img = dinosaurJumpImg;
                    dinosaur.isRunning = false;
                }

                if (gameOver) {
                    dinosaur.y = dinosaurY;
                    dinosaur.img = dinosaurRun1;
                    dinosaur.isRunning = true;
                    velocityY = 0;
                    cactusArray = [];
                    bloodArray = [];
                    collectedBlood = 0;
                    score = 0;
                    hospital = null;
                    gameOver = false;

                    clearInterval(placeCactusInterval);
                    clearInterval(placeBloodInterval);
                    placeCactusInterval = setInterval(placeCactus, 500);
                    placeBloodInterval = setInterval(placeBlood, 1000);

                    requestAnimationFrame(gameLoop);
                }
            }
        });

        gameLoop();
    </script>
</body>

</html>