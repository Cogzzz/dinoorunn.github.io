<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome Dinosaur Game</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        
        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        #game-canvas {
            background-color: #fff;
            border: 1px solid #ccc;
        }
        
        #instructions {
            margin-top: 20px;
            text-align: center;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="game-canvas" width="750" height="250"></canvas>
        <div id="instructions">
            <p>Tekan SPASI untuk melompat. Jika game over, tekan SPASI untuk mulai kembali.</p>
        </div>
    </div>

    <script>
        // Game variables
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const boardWidth = 750;
        const boardHeight = 250;

        // Dinosaur properties
        const dinosaurWidth = 88;
        const dinosaurHeight = 94;
        const dinosaurX = 50;
        let dinosaurY = boardHeight - dinosaurHeight;

        // Cactus properties
        const cactus1Width = 34;
        const cactus2Width = 69;
        const cactus3Width = 102;
        const cactusHeight = 70;
        const cactusX = 700;
        const cactusY = boardHeight - cactusHeight;
        
        // Physics
        let velocityX = -8;  // Cactus moving left speed (slowed down from -12)
        let velocityY = 10;    // Dinosaur jump speed
        const gravity = 0.6;  // Reduced gravity for slower falling

        // Game state
        let gameOver = false;
        let score = 0;
        let cactusArray = [];
        
        // Animation
        let runFrame = 0;
        const runFrameCount = 2; // Jumlah frame untuk animasi berlari
        let animationCounter = 0;
        const animationSpeed = 7; // Semakin kecil, semakin cepat

        // Images
        const dinosaurRun1 = new Image();
        const dinosaurRun2 = new Image();
        const dinosaurDeadImg = new Image();
        const dinosaurJumpImg = new Image();
        const cactus1Img = new Image();
        const cactus2Img = new Image();
        const cactus3Img = new Image();

        // Load images
        dinosaurRun1.src = 'img/dino-run1.png'; // Frame 1 dari sprite sheet
        dinosaurRun2.src = 'img/dino-run2.png'; // Frame 2 dari sprite sheet
        dinosaurDeadImg.src = 'img/dino-dead.png';
        dinosaurJumpImg.src = 'img/dino-jump.png';
        cactus1Img.src = 'img/cactus1.png';
        cactus2Img.src = 'img/cactus2.png';
        cactus3Img.src = 'img/cactus3.png';

        // Create dinosaur object
        const dinosaur = {
            x: dinosaurX,
            y: dinosaurY,
            width: dinosaurWidth,
            height: dinosaurHeight,
            img: dinosaurRun1, // Default ke frame pertama
            isRunning: true
        };

        // Function to place cactus
        function placeCactus() {
            if (gameOver) {
                return;
            }

            const placeCactusChance = Math.random(); // 0 - 0.999999
            
            if (placeCactusChance > 0.90) { // 10% chance for cactus3
                const cactus = {
                    x: cactusX,
                    y: cactusY,
                    width: cactus3Width,
                    height: cactusHeight,
                    img: cactus3Img
                };
                cactusArray.push(cactus);
            }
            else if (placeCactusChance > 0.70) { // 20% chance for cactus2
                const cactus = {
                    x: cactusX,
                    y: cactusY,
                    width: cactus2Width,
                    height: cactusHeight,
                    img: cactus2Img
                };
                cactusArray.push(cactus);
            }
            else if (placeCactusChance > 0.50) { // 20% chance for cactus1
                const cactus = {
                    x: cactusX,
                    y: cactusY,
                    width: cactus1Width,
                    height: cactusHeight,
                    img: cactus1Img
                };
                cactusArray.push(cactus);
            }

            if (cactusArray.length > 10) {
                cactusArray.shift(); // Remove the first cactus from array
            }
        }

        // Function to check collision
        function collision(a, b) {
            return a.x < b.x + b.width &&   // a's top left corner doesn't reach b's top right corner
                   a.x + a.width > b.x &&   // a's top right corner passes b's top left corner
                   a.y < b.y + b.height &&  // a's top left corner doesn't reach b's bottom left corner
                   a.y + a.height > b.y;    // a's bottom left corner passes b's top left corner
        }

        // Function to update game state
        function update() {
            if (gameOver) {
                return;
            }

            // Update dinosaur position
            velocityY += gravity;
            dinosaur.y += velocityY;

            if (dinosaur.y > dinosaurY) { // Stop the dinosaur from falling past the ground
                dinosaur.y = dinosaurY;
                velocityY = 0;
                dinosaur.isRunning = true; // Set to running state when landing
            }

            // Animate running dinosaur
            if (dinosaur.isRunning) {
                animationCounter++;
                if (animationCounter >= animationSpeed) {
                    runFrame = (runFrame + 1) % runFrameCount;
                    dinosaur.img = runFrame === 0 ? dinosaurRun1 : dinosaurRun2;
                    animationCounter = 0;
                }
            }

            // Update cactus positions and check collisions
            for (let i = 0; i < cactusArray.length; i++) {
                const cactus = cactusArray[i];
                cactus.x += velocityX;

                if (collision(dinosaur, cactus)) {
                    gameOver = true;
                    dinosaur.img = dinosaurDeadImg;
                }
            }

            // Update score
            score++;
        }

        // Function to draw game
        function draw() {
            // Clear canvas
            ctx.clearRect(0, 0, boardWidth, boardHeight);
            
            // Draw dinosaur
            ctx.drawImage(dinosaur.img, dinosaur.x, dinosaur.y, dinosaur.width, dinosaur.height);

            // Draw cactus
            for (let i = 0; i < cactusArray.length; i++) {
                const cactus = cactusArray[i];
                ctx.drawImage(cactus.img, cactus.x, cactus.y, cactus.width, cactus.height);
            }

            // Draw score
            ctx.fillStyle = "black";
            ctx.font = "32px Courier";
            if (gameOver) {
                ctx.fillText("Game Over: " + score, 10, 35);
            } else {
                ctx.fillText(score, 10, 35);
            }
        }

        // Game loop
        function gameLoop() {
            update();
            draw();
            if (!gameOver) {
                requestAnimationFrame(gameLoop);
            }
        }

        // Start placing cactus at intervals
        let placeCactusInterval = setInterval(placeCactus, 500); // Increased from 1500ms to 2000ms

        // Handle keyboard input
        document.addEventListener("keydown", function(event) {
            if (event.code === "Space") {
                // System.out.println("JUMP!");
                if (dinosaur.y === dinosaurY) {
                    velocityY = -14; // Reduced from -17 for slower jump
                    dinosaur.img = dinosaurJumpImg;
                    dinosaur.isRunning = false; // Stop running animation during jump
                }
                
                if (gameOver) {
                    //restart game by resetting conditions
                    dinosaur.y = dinosaurY;
                    dinosaur.img = dinosaurRun1;
                    dinosaur.isRunning = true;
                    velocityY = 0;
                    cactusArray = [];
                    score = 0;
                    gameOver = false;
                    
                    // Restart intervals
                    clearInterval(placeCactusInterval);
                    placeCactusInterval = setInterval(placeCactus, 500); // Use the same 2000ms interval
                    
                    // Restart game loop
                    requestAnimationFrame(gameLoop);
                }
            }
        });

        // Start the game
        gameLoop();
    </script>
</body>
</html>